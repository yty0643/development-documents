# 리덕스(Redux)

## 리덕스란?

리덕스는 리액트 생태계에서 가장 사용률이 높은 상태관리 라이브러리이다.

리덕스를 사용하면 만들게 될 컴포넌트들의 상태 관련 로직들을 다른 파일들로 분리시켜서 더욱 효율적으로 관리 할 수 있으며 글로벌 상태 관리도 손쉽게 할 수 있다.

## 리덕스가 필요한 이유는?

리액트 프로젝트에서는 대부분의 작업을 할 때 부모 `component`가 중간자 역할을 한다. (컴포넌트끼리 직접 소통하는 방법도 있지만 권장하지 않는 방식이다.) 부모 컴포넌트에서 `state` 및 `state`를 업데이트하는 함수를 생성하고 이를 자식 `component`에 전달하는 방식으로 `state`를 관리하는데, 이러한 방식은 꽤나 직관적이고 편리하다. 하지만 문제는 프로젝트의 규모가 커졌을 때 발생한다. 다루는 `component`와 `props`가 늘어나면 `props`를 부모에서 자식으로, 또 자식에서 그 자식으로, 또 자식에서 자식으로... 매번 중복되는 코드를 작성하게되며 코드량이 증가한다. 또한 `props`의 이름을 수정하려면 `props`전달에 관련된 모든 `component` 파일을 열어서 이름을 수정해야 하는 번거로움이 발생한다. 이처럼 유지보수에도 큰 어려움이 발생한다.

리덕스를 사용하면 `state`관련 로직을 다른 파일로 분리하기 때문에 `props`를 `component`에 종속시키지 않아도 된다.
즉 부모에서 자식으로 `props`를 전달하는 과정이 필요가 없고, 유지보수에 큰 도움이 된다.

## 리덕스의 세가지 규칙

### 하나의 애플리케이션에선 단 한개의 스토어를 만들어서 사용합니다. <br/>

여러개의 스토어를 사용하는것은 사실 가능하기는 하나, 권장되지는 않습니다. 특정 업데이트가 너무 빈번하게 일어나거나, 애플리케이션의 특정 부분을 완전히 분리시키게 될 때 여러개의 스토어를 만들 수도 있습니다. 하지만 그렇게 하면, 개발 도구를 활용하지 못하게 됩니다.

### 상태는 읽기전용 입니다.<br/>

리액트에서 state 를 업데이트 해야 할 때, setState 를 사용하고, 배열을 업데이트 해야 할 때는 배열 자체에 push 를 직접 하지 않고, concat 같은 함수를 사용하여 기존의 배열은 수정하지 않고 새로운 배열을 만들어서 교체하는 방식으로 업데이트를 합니다. 엄청 깊은 구조로 되어있는 객체를 업데이트를 할 때도 마찬가지로, 기존의 객체는 건드리지 않고 Object.assign 을 사용하거나 spread 연산자 (...) 를 사용하여 업데이트 하곤 하죠.

리덕스에서도 마찬가지입니다. 기존의 상태는 건들이지 않고 새로운 상태를 생성하여 업데이트 해주는 방식으로 해주면, 나중에 개발자 도구를 통해서 뒤로 돌릴 수도 있고 다시 앞으로 돌릴 수도 있습니다.

리덕스에서 불변성을 유지해야 하는 이유는 내부적으로 데이터가 변경 되는 것을 감지하기 위하여 shallow equality 검사를 하기 때문입니다. 이를 통하여 객체의 변화를 감지 할 때 객체의 깊숙한 안쪽까지 비교를 하는 것이 아니라 겉핥기 식으로 비교를 하여 좋은 성능을 유지할 수 있는 것이죠.

우리는 이 튜토리얼에서는 Immutable.js 혹은 Immer.js 를 사용하여 불변성을 유지하며 상태를 관리하는 방법에 대해서 다뤄보게 됩니다. 불변성과 Immutable.js 가 익숙하지 않다면 리액트의 불변함, 그리고 컴포넌트에서 Immutable.js 사용하기 포스트를 읽으시면 도움이 될거에요.

### 변화를 일으키는 함수, 리듀서는 순수한 함수여야 합니다.<br/>

순수한 함수, 라는 개념이 익숙하지 않으시죠. 다음 사항을 기억해주세요.

리듀서 함수는 이전 상태와, 액션 객체를 파라미터로 받습니다.
이전의 상태는 절대로 건들이지 않고, 변화를 일으킨 새로운 상태 객체를 만들어서 반환합니다.
똑같은 파라미터로 호출된 리듀서 함수는 언제나 똑같은 결과값을 반환해야만 합니다.
3가지 사항을 주의해주세요. 동일한 인풋이라면 언제나 동일한 아웃풋이 있어야 합니다. 그런데 일부 로직들 중에서는 실행 할 때마다 다른 결과값이 나타날 수도 있죠. new Date() 를 사용한다던지.. 랜덤 숫자를 생성한다던지.. 혹은, 네트워크에 요청을 한다던지! 그러한 작업은 결코 순수하지 않은 작업이므로, 리듀서 함수의 바깥에서 처리해줘야 합니다. 그런것을 하기 위해서, 리덕스 미들웨어 를 사용하곤 하죠. 이에 대해선 나중에 다뤄보게 됩니다.
